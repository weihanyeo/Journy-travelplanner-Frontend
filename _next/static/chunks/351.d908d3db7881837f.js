(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[351],{5351:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var n=r(5893),o=r(7294),a=r(3097),i=r(9597),l=r(8163),s=r.n(l),c=r(2816),u=r.n(c),d=r(5715),p=r(2013),f=r(4867),m=r(7262),g=r(7509);function w(e){let{layer:t,center:r,geometry:a}=e,[i,l]=(0,o.useState)(0);(0,o.useEffect)(()=>{l(e=>e+1)},[r,t]);let s=new g.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/3699/3699561.png",iconSize:[38,38]}),c=()=>{if(!t||!t.features||!a)return null;let e=[],r=a.flat();for(let t=0;t<r.length-1;t++){let n=[r[t][1],r[t][0]],o=[r[t+1][1],r[t+1][0]];e.push([n,o])}return e};return(0,n.jsx)("div",{children:(0,n.jsxs)(d.h,{center:r,zoom:8,scrollWheelZoom:!1,style:{height:"500px",width:"500px",borderRadius:"15px"},children:[(0,n.jsx)(p.I,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t&&(0,n.jsx)(f.Q,{data:t,pointToLayer:(e,r)=>{let n=t.features.indexOf(e)+1;return(0,g.marker)(r,{icon:s}).bindPopup("".concat(n,". ").concat(e.properties.name))}},i),c()&&c().map((e,t)=>(0,n.jsx)(m.a,{positions:e,color:"red"},t))]},i)})}r(3183),r(4079);var y=r(9603),h=r(9417),x=e=>{let{onChangeKML:t,initialPostId:r=null}=e;var l=void 0;(0,o.useEffect)(()=>{r&&c(r)},[]);let c=async e=>{try{await a.Z.get("/posts/".concat(e,"/kml-file")).then(e=>{C(e.data)})}catch(e){console.error(e)}},[d,p]=(0,o.useState)(""),[f,m]=(0,o.useState)([]),g=function(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];clearTimeout(t),t=setTimeout(()=>{e.apply(l,o)},r)}}(async()=>{if(""!=d)try{await a.t.get("https://api.geoapify.com/v1/geocode/autocomplete?text=".concat(d,"&format=json&apiKey=ed24fe3439e946d5a60cda3a1b687587")).then(e=>m(e.data.results))}catch(e){console.error(e)}}),[x,v]=(0,o.useState)(null),[j,b]=(0,o.useState)([1.294385,103.7727545]),[k,S]=(0,o.useState)([]);(0,o.useEffect)(()=>{v(z())},[k]);let N=async(e,t)=>{try{return await a.t.get("https://api.geoapify.com/v1/geocode/reverse?lat=".concat(e,"&lon=").concat(t,"&format=json&apiKey=ed24fe3439e946d5a60cda3a1b687587"))}catch(e){console.error(e)}},P=async e=>{if(null!=e){let t=e.features.map(e=>{let t=e.geometry.coordinates;return[t[1],t[0]]});try{let e=t.map(async e=>{let t=e[0].toString(),r=e[1].toString();return await N(t,r)}),r=await Promise.all(e);S(r)}catch(e){return console.error(e),[]}}},C=e=>{let t=new DOMParser().parseFromString(e,"text/xml"),r=i.kml(t);s()(r,!1),r.features.forEach(e=>{let t=[e.geometry.coordinates[1],e.geometry.coordinates[0]];return{...e,geometry:{type:"Point",coordinates:t}}}),v(r),b([r.features[0].geometry.coordinates[1],r.features[0].geometry.coordinates[0]]),P(r)},L=e=>{let t=e.target.value.split(" ");N(t[0],t[1]).then(e=>{S([...k,e])})},D=e=>{let t=e.target.value.split(" ");S(k.filter(e=>e.data.query.lat!=t[0]&&e.data.query.lon!=t[1]))},[M,_]=(0,o.useState)("drive"),[E,q]=(0,o.useState)([]),[G,O]=(0,o.useState)([]),T=async()=>{if(k.length>1){let e="";k.forEach(t=>e+=t.data.query.lat+","+t.data.query.lon+"|"),e=e.substring(0,e.length-1);try{await a.t.get("https://api.geoapify.com/v1/routing?waypoints=".concat(e,"&mode=").concat(M,"&apiKey=ed24fe3439e946d5a60cda3a1b687587")).then(e=>{q(e.data.features[0].properties.legs),O(e.data.features[0].geometry.coordinates)})}catch(e){console.error(e)}}};(0,o.useEffect)(()=>{T()},[k,M]);let z=()=>{if(k.length>0)return{type:"FeatureCollection",features:k.map(e=>{let t=e.data.query.lat;return{type:"Feature",geometry:{type:"Point",coordinates:[e.data.query.lon,t]},properties:{name:e.data.results[0].address_line1}}})}},F=(e,t)=>{e.dataTransfer.setData("index",t.toString())},I=e=>{e.preventDefault()},U=(e,t)=>{let r=parseInt(e.dataTransfer.getData("index"));if(r!==t){let e=[...k],[n]=e.splice(r,1);e.splice(t,0,n),S(e)}},[B,R]=(0,o.useState)([]),W=e=>{let t=[...B];t.includes(e)?t.splice(t.indexOf(e),1):t.push(e),R(t)};return(0,n.jsxs)("div",{className:"tw-flex tw-flex-row tw-w-full tw-justify-evenly tw-p-10 tw-h-full tw-text-white tw-gap-5",children:[(0,n.jsxs)("div",{className:"tw-bg-beige tw-text-blue tw-p-5 tw-rounded tw-gap-5 tw-flex tw-flex-col  tw-w-1/2",children:[(0,n.jsx)("h5",{className:"tw-font-bold",children:"Selected Locations"}),k.length>0?(0,n.jsxs)("div",{className:"tw-flex tw-flex-col tw-justify-between tw-h-full",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"tw-border-2 tw-gap-3 tw-flex",children:[(0,n.jsx)("b",{children:"Mode of Transport:"}),(0,n.jsxs)("select",{onChange:e=>_(e.target.value),children:[(0,n.jsx)("option",{value:"drive",children:"Car"}),(0,n.jsx)("option",{value:"walk",children:"Walking"}),(0,n.jsx)("option",{value:"cycle",children:"Cycling"})]})]}),(0,n.jsx)("ol",{children:k.map((e,t)=>(0,n.jsx)("li",{style:{marginBottom:"20px"},draggable:"true",onDragStart:e=>F(e,t),onDragOver:I,onDrop:e=>U(e,t),children:(0,n.jsxs)("div",{className:"tw-flex tw-flex-col tw-mb-10 tw-gap-3",children:[(0,n.jsxs)("div",{className:"tw-flex tw-flex-row tw-gap-2 tw-items-center tw-justify-between",children:[(0,n.jsxs)("div",{className:"tw-cursor-pointer",children:[(0,n.jsx)("div",{children:e.data.results[0].address_line1}),(0,n.jsx)("div",{children:e.data.results[0].address_line2})]}),(0,n.jsxs)("button",{type:"button",className:"tw-text-beige rounded tw-w-fit tw-h-fit tw-bg-red tw-border-0 tw-flex tw-flex-row tw-gap-2 tw-items-center",onClick:D,value:"".concat(e.data.query.lat," ").concat(e.data.query.lon),children:["Remove",(0,n.jsx)(y.G,{icon:h.$aW})]})]}),t<E.length&&(0,n.jsxs)("div",{className:"tw-ml-5",children:[(0,n.jsxs)("button",{className:"tw-bg-transparent tw-text-green tw-border-0 tw-font-bold tw-w-fit tw-h-fit tw-flex-row tw-gap-2 tw-flex tw-items-centers",onClick:()=>W(t),"aria-expanded":B.includes(t)?"true":"false","aria-controls":"collapseExample".concat(t),children:[(0,n.jsx)(y.G,{icon:h.yh$}),"Directions"]}),E[t].steps.map(e=>(0,n.jsx)("dd",{className:"collapse ".concat(B.includes(t)?"show":""),id:"collapseExample".concat(t),children:e.instruction.text}))]})]})},t))})]}),(0,n.jsx)("button",{type:"button",className:"tw-bg-green tw-text-beige tw-rounded tw-font-bold",onClick:()=>{let e=z();t(new Blob([u()(e)],{type:"kml"}))},children:"Save Map Changes"})]}):(0,n.jsxs)("b",{children:[(0,n.jsx)(y.G,{icon:h.iUi})," No Locations to display yet..."]})]}),(0,n.jsxs)("div",{className:"tw-flex tw-flex-col tw-gap-10 tw-w-1/2",children:[(0,n.jsx)(w,{layer:x,center:j,geometry:G}),(0,n.jsxs)("div",{className:"tw-bg-beige tw-text-blue tw-p-5 tw-rounded tw-gap-5 tw-flex tw-flex-col tw-h-72 tw-w-full",children:[(0,n.jsx)("h5",{className:"tw-font-bold",children:"Where Next?"}),(0,n.jsx)("input",{onChange:e=>{p(e.target.value),g()},value:d,placeholder:"Search for any location"}),f.length>0&&(0,n.jsx)("div",{className:"tw-overflow-y-auto tw-flex tw-flex-col tw-gap-3 tw-p-3",children:f.map(e=>(0,n.jsxs)("li",{className:"tw-p-3 tw-flex tw-flex-row tw-justify-between tw-gap-2",children:[(0,n.jsxs)("div",{children:[e.address_line1,",",e.address_line2]}),(0,n.jsx)("div",{value:e.lon}),(0,n.jsx)("div",{value:e.lat}),(0,n.jsx)("button",{onClick:L,className:"tw-bg-transparent tw-text-green tw-border-0 tw-font-bold",value:"".concat(e.lat," ").concat(e.lon),children:"+"})]}))})]})]})]})}},4079:function(e){e.exports={"leaflet-container":"leafletStyles_leaflet-container__liJxZ"}},442:function(e){function t(e){return e&&e.length?" "+e.map(function(e){return e[0]+'="'+e[1]+'"'}).join(" "):""}e.exports.attr=t,e.exports.tagClose=function(e,r){return"<"+e+t(r)+"/>"},e.exports.tag=function(e,r,n){return"<"+e+t(n)+">"+r+"</"+e+">"},e.exports.encode=function(e){return(null===e?"":e.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},2816:function(e,t,r){var n=r(442),o=n.tag,a=n.encode;function i(e,t){return function(r){if(!r.properties||!l.valid(r.geometry))return"";var n,i,s,d=l.any(r.geometry);if(!d)return"";var p="",f="";if(e.simplestyle){var m,g,w,y,h,x,v,j,b,k,S=(m=r.properties,g="",m["marker-symbol"]&&(g=g+"ms"+m["marker-symbol"]),m["marker-color"]&&(g=g+"mc"+m["marker-color"].replace("#","")),m["marker-size"]&&(g=g+"ms"+m["marker-size"]),m.stroke&&(g=g+"s"+m.stroke.replace("#","")),m["stroke-width"]&&(g=g+"sw"+m["stroke-width"].toString().replace(".","")),m["stroke-opacity"]&&(g=g+"mo"+m["stroke-opacity"].toString().replace(".","")),m.fill&&(g=g+"f"+m.fill.replace("#","")),m["fill-opacity"]&&(g=g+"fo"+m["fill-opacity"].toString().replace(".","")),g);S&&(l.isPoint(r.geometry)&&((w=r.properties)["marker-size"]||w["marker-symbol"]||w["marker-color"])?(-1===t.indexOf(S)&&(p=o("Style",o("IconStyle",o("Icon",o("href",(h=(y=r.properties)["marker-size"]||"medium",x=y["marker-symbol"]?"-"+y["marker-symbol"]:"",v=(y["marker-color"]||"7e7e7e").replace("#",""),"https://api.tiles.mapbox.com/v3/marker/pin-"+h.charAt(0)+x+"+"+v+".png"))))+o("hotSpot","",[["xunits","fraction"],["yunits","fraction"],["x",.5],["y",.5]]),[["id",S]]),t.push(S)),f=o("styleUrl","#"+S)):(l.isPolygon(r.geometry)||l.isLine(r.geometry))&&function(e){for(var t in e)if(({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0})[t])return!0}(r.properties)&&(-1===t.indexOf(S)&&(b=o("LineStyle",[o("color",u((j=r.properties).stroke,j["stroke-opacity"])||"ff555555")+o("width",void 0===j["stroke-width"]?2:j["stroke-width"])]),k="",(j.fill||j["fill-opacity"])&&(k=o("PolyStyle",[o("color",u(j.fill,j["fill-opacity"])||"88555555")])),p=o("Style",b+k,[["id",S]]),t.push(S)),f=o("styleUrl","#"+S)))}return p+o("Placemark",((n=r.properties)[e.name]?o("name",a(n[e.name])):"")+((i=r.properties)[e.description]?o("description",a(i[e.description])):"")+o("ExtendedData",(function(e){var t=[];for(var r in e)t.push([r,e[r]]);return t})(r.properties).map(c).join(""))+((s=r.properties)[e.timestamp]?o("TimeStamp",o("when",a(s[e.timestamp]))):"")+d+f)}}e.exports=function(e,t){var r,n;return'<?xml version="1.0" encoding="UTF-8"?>'+o("kml",o("Document",(void 0!==(r=t=t||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"}).documentName?o("name",r.documentName):"")+(void 0!==(n=t).documentDescription?o("description",n.documentDescription):"")+function(e,t){if(!e.type)return"";var r=[];switch(e.type){case"FeatureCollection":if(!e.features)return"";return e.features.map(i(t,r)).join("");case"Feature":return i(t,r)(e);default:return i(t,r)({type:"Feature",geometry:e,properties:{}})}}(e,t)),[["xmlns","http://www.opengis.net/kml/2.2"]])};var l={Point:function(e){return o("Point",o("coordinates",e.coordinates.join(",")))},LineString:function(e){return o("LineString",o("coordinates",s(e.coordinates)))},Polygon:function(e){if(!e.coordinates.length)return"";var t=e.coordinates[0],r=e.coordinates.slice(1),n=o("outerBoundaryIs",o("LinearRing",o("coordinates",s(t)))),a=r.map(function(e){return o("innerBoundaryIs",o("LinearRing",o("coordinates",s(e))))}).join("");return o("Polygon",n+a)},MultiPoint:function(e){return e.coordinates.length?o("MultiGeometry",e.coordinates.map(function(e){return l.Point({coordinates:e})}).join("")):""},MultiPolygon:function(e){return e.coordinates.length?o("MultiGeometry",e.coordinates.map(function(e){return l.Polygon({coordinates:e})}).join("")):""},MultiLineString:function(e){return e.coordinates.length?o("MultiGeometry",e.coordinates.map(function(e){return l.LineString({coordinates:e})}).join("")):""},GeometryCollection:function(e){return o("MultiGeometry",e.geometries.map(l.any).join(""))},valid:function(e){return e&&e.type&&(e.coordinates||"GeometryCollection"===e.type&&e.geometries&&e.geometries.every(l.valid))},any:function(e){return l[e.type]?l[e.type](e):""},isPoint:function(e){return"Point"===e.type||"MultiPoint"===e.type},isPolygon:function(e){return"Polygon"===e.type||"MultiPolygon"===e.type},isLine:function(e){return"LineString"===e.type||"MultiLineString"===e.type}};function s(e){return e.map(function(e){return e.join(",")}).join(" ")}function c(e){return o("Data",o("value",a(e[1])),[["name",a(e[0])]])}function u(e,t){if("string"!=typeof e)return"";if(3===(e=e.replace("#","").toLowerCase()).length)e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2];else if(6!==e.length)return"";var r=e[0]+e[1],n=e[2]+e[3],o=e[4]+e[5],a="ff";return"number"==typeof t&&t>=0&&t<=1&&((a=(255*t).toString(16)).indexOf(".")>-1&&(a=a.substr(0,a.indexOf("."))),a.length<2&&(a="0"+a)),a+o+n+r}}}]);